---
layout: default
title: Store
---
<script>
function openModal(item) {

  document.getElementById('modal').classList.remove('hidden');
  document.getElementById('modalImage').src = `${BASEURL}${item.image}`;
  document.getElementById('modalTitle').textContent = item.name;
  document.getElementById('modalPrice').textContent = formatPrice(item.prices);
  document.getElementById('modalDesc').textContent = item.description;
  document.getElementById('modalIncludes').innerHTML = item.includes
    .filter(i => typeof i === 'string' && i.trim() !== '')
    .map(i => `<li>${i}</li>`)
    .join('');
  document.getElementById('modalAddBtn').onclick = function() {
    const selEl = document.getElementById('modalDropdown');
    const selection = selEl ? selEl.value : '';
    addToCart({ ...item, selection });
    closeModal();
  };
  // Populate or hide vehicle dropdown
  const ddContainer = document.getElementById('modalDropdownContainer');
  const ddSelect    = document.getElementById('modalDropdown');
  if (item.dropdown && item.dropdown.source) {
    // set dynamic label
    document.getElementById('modalDropdownLabel').innerText = item.dropdown.title || 'Select';
    ddContainer.classList.remove('hidden');
    ddSelect.innerHTML = '';
    fetch(item.dropdown.source)
      .then(res => res.json())
      .then(data => {
        (data[item.dropdown.list_key] || []).forEach(entry => {
          const opt = document.createElement('option');
          opt.value = item.dropdown.value_template
            .replace(/\{\{\s*brand\s*\}\}/g, entry.brand)
            .replace(/\{\{\s*model\s*\}\}/g, entry.model)
            .replace(/\{\{\s*year\s*\}\}/g, entry.year)
            .replace(/\{\{\s*variant\s*\}\}/g, entry.variant)
            .trim();
          opt.text = opt.value;
          ddSelect.appendChild(opt);
        });
      });
  } else {
    // hide and clear dropdown
    ddContainer.classList.add('hidden');
    document.getElementById('modalDropdownLabel').innerText = '';
    ddSelect.innerHTML = '';
  }
}

function closeModal() {
  document.getElementById('modal').classList.add('hidden');
}

function goToBuyPage() {
  window.location.href = "{{ '/product' | relative_url }}";
}

document.addEventListener("DOMContentLoaded", () => {
  const locale = localStorage.getItem("preferredLocale") || navigator.language || "en-US";
  const currency = getCurrencyCode(locale);
  const formatter = getFormatter(locale);

  document.querySelectorAll(".product-card").forEach(card => {
    const prices = JSON.parse(card.dataset.prices);
    const price = prices[currency] || prices["USD"] || 0;
    const priceEl = card.querySelector(".product-price");
    if (priceEl) priceEl.innerText = formatter.format(price);
  });
});
</script>

<!-- Hero -->
<section class="flex justify-center py-16 px-4">
  <div class="bg-card rounded-lg p-8 max-w-3xl w-full text-center h-[40vh] aspect-[1.68]">
    <h1 class="text-4xl font-bold mb-4 text-white">KommuAssist 2.0</h1>
    <img src="{{ "" | relative_url }}/img/products/device/1.png" width="100%" class="mb-4">
    <p class="mb-4 text-white">RM3,699 or RM150/month with rent-to-own</p>
    <button onclick="goToBuyPage()" class="bg-blue-500 px-6 py-2 rounded-full text-white">Buy</button>
  </div>
</section>

<!-- Accessories -->
<section class="px-4 flex justify-center">
  <div class="w-full max-w-[1100px]">

  <h2 class="text-2xl font-semibold mb-6 text-white">Shop Accessories</h2>

  {% assign categories = "Hardware,Cables & connectors,Others" | split: "," %}
  {% for category in categories %}
    <h3 class="text-xl font-bold mt-8 mb-4 text-white">{{ category }}</h3>
    <div class="flex overflow-x-auto overflow-y-visible md:overflow-visible space-x-4 md:grid md:grid-cols-[repeat(auto-fill,minmax(12rem,1fr))] pr-0 mr-0 md:gap-3">
      {% for item in site.data.products %}
        {% if item.category == category %}
          <div onclick='openModal({
            name: "{{ item.name }}",
            prices: {{ item.prices | jsonify }},
            image: "{{ item.image }}",
            description: "{{ item.description }}",
            includes: {{ item.includes | jsonify }}
            ,dropdown: {{ item.dropdown | jsonify }}
          })' class="product-card bg-card p-4 rounded-lg text-center cursor-pointer min-w-[12rem] transition-transform transform hover:-translate-y-1 hover:shadow-lg" data-prices='{{ item.prices | jsonify }}'>
            <img src="{{ item.image | relative_url}}" alt="{{ item.name }}" class="w-full h-32 object-contain mb-3 rounded">
            <div class="font-semibold text-white">{{ item.name }}</div>
            <div class="text-sm text-gray-400 product-price">Loading...</div>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  {% endfor %}
  </div>
</section>

<!-- Accessory Modal -->
<div id="modal" class="fixed inset-0 bg-card bg-opacity-70 flex items-center justify-center z-50 hidden">
  <div class="bg-card p-6 rounded-lg w-full max-w-4xl relative">
    <button onclick="closeModal()" class="absolute top-2 right-2 text-white">âœ•</button>
    <div class="flex flex-col md:flex-row md:items-center  gap-6">
      <div class="md:w-1/2">
        <img id="modalImage" src="" class="w-full h-64 object-contain rounded">
      </div>
      <div class="md:w-1/2">
        <h3 id="modalTitle" class="text-2xl font-bold mb-1 text-white"></h3>
        <p id="modalPrice" class="text-sm text-gray-400 mb-4"></p>
        <div id="modalDropdownContainer" class="mb-4 hidden">
          <label id="modalDropdownLabel" for="modalDropdown" class="block font-semibold text-white mb-1"></label>
          <select id="modalDropdown" class="w-full bg-card border-1 border-gray-600 rounded px-3 py-2 text-white font-normal"></select>
        </div>
        <p class="text-white mb-1">Description</p>
        <p id="modalDesc" class="font-normal text-sm text-gray-300 mb-4"></p>
        <p class="font-semibold text-white mb-1">Included:</p>
        <ol id="modalIncludes" class="font-normal list-disc list-inside space-y-1 text-white mb-6"></ol>
        <button id="modalAddBtn" class="block mx-auto bg-blue-500 px-6 py-2 rounded text-white">Add to Cart</button>
      </div>
    </div>
  </div>
</div>
